<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portafolio - Horizont</title>
    <link rel="stylesheet" href="../../styles/base/main.css">
    <link rel="stylesheet" href="../../styles/pages/portfolio.css">
    <link rel="stylesheet" href="../../styles/components/footer.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<nav class="navbar">
    <div class="logo">
        <a href="index.html">
            <img src="../../Resources/HORIZONT.png" class="logo-img" alt="HORIZONT">
        </a>
    </div>
    <ul class="nav-links">
        <li><a href="index.html">Inicio</a></li>
        <li><a href="trading.html">Trading</a></li>
        <li><a href="portfolio.html" class="active">Portafolio</a></li>
        <li>
            <a href="notifications.html" class="notifications-link" title="Notificaciones">
                <span class="material-icons">notifications</span>
                <span class="visually-hidden">Notificaciones</span>
            </a>
        </li>
    </ul>


    <div class="user-menu">
        <a href="login.html" id="loginLink">Iniciar Sesión</a>
        <div id="userInfo" style="display: none;">
            <span id="userName" class="material-icons">account_circle</span>
            <span id="userGreeting" style="margin: 0 8px;"></span>
            <button id="logoutBtn" class="btn-logout">Cerrar sesión</button>
        </div>
    </div>
</nav>

<main class="portfolio-container">
    <!-- Resumen del Portafolio -->
    <section class="portfolio-summary">
        <div class="summary-header">
            <h1>Mi Portafolio</h1>
            <div class="portfolio-actions">
                <button class="btn-refresh">
                    <img src="https://cdn-icons-png.flaticon.com/512/1827/1827933.png" alt="Actualizar" style="width:20px;height:20px;vertical-align:middle;margin-right:4px;">
                    Actualizar
                </button>
                <button class="btn-export">
                    <img src="https://cdn-icons-png.flaticon.com/512/724/724933.png" alt="Exportar" style="width:20px;height:20px;vertical-align:middle;margin-right:4px;">
                    Exportar
                </button>
            </div>
        </div>



        <div class="summary-cards">
            <div class="summary-card">
                <div class="card-icon total-value">
                    <img src="https://cdn-icons-png.flaticon.com/512/2920/2920256.png" alt="Cartera" style="width:32px;height:32px;">
                </div>
                <div class="card-content">
                    <h3>Valor Total</h3>
                    <p class="value" id="totalValue">$0.00</p>
                </div>
            </div>
            <div class="summary-card">
                <div class="card-icon daily-change">
                    <img src="https://cdn-icons-png.flaticon.com/512/1170/1170627.png" alt="Cambio Diario" style="width:32px;height:32px;">
                </div>
                <div class="card-content">
                    <h3>Cambio Diario</h3>
                    <p class="value positive" id="dailyChange">+$0.00 (0.00%)</p>
                </div>
            </div>
            <div class="summary-card">
                <div class="card-icon total-gain">
                    <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" alt="Ganancia Total" style="width:32px;height:32px;">
                </div>
                <div class="card-content">
                    <h3>Ganancia Total</h3>
                    <p class="value positive" id="totalGain">+$0.00 (0.00%)</p>
                </div>
            </div>
            <div class="summary-card">
                <div class="card-icon cash-balance">
                    <img src="https://cdn-icons-png.flaticon.com/512/2331/2331943.png" alt="Efectivo" style="width:32px;height:32px;">
                </div>
                <div class="card-content">
                    <h3>Efectivo Disponible</h3>
                    <p class="value" id="cashBalance">$0.00</p>
                </div>
            </div>
        </div>
    </section>

  <!-- NUEVA TARJETA: Ganancias y Comisiones -->
<section class="portfolio-card rounded-card">
  <div class="portfolio-card-header">
    <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" alt="Ganancias" style="width:22px;height:22px;vertical-align:middle;margin-right:8px;">
    Ganancias y Comisiones
  </div>

  <div class="portfolio-card-body">
    <div class="scrollable-table">
      <table class="portfolio-table">
        <thead>
          <tr>
            <th><span class="material-icons">show_chart</span> Símbolo</th>
            <th><span class="material-icons">trending_up</span> Ganancia/Pérdida</th>
            <th><span class="material-icons">attach_money</span> Comisión Total</th>
            <th><span class="material-icons">person</span> Horizont</th>
            <!-- Columna futura (oculta) -->
            <th class="hide-column"><span class="material-icons">groups</span> Comisionista</th>
          </tr>
        </thead>
        <tbody id="gainsCommissionsTableBody">
          <!-- Datos dinámicos -->
        </tbody>
      </table>
    </div>
  </div>
</section>



    <div id="watchlist-content"></div>


    <!-- NUEVA TARJETA: Historial de Órdenes -->
    <section class="portfolio-card rounded-card">
        <div class="portfolio-card-header">
            <img src="https://cdn-icons-png.flaticon.com/512/1827/1827933.png" alt="Órdenes" style="width:22px;height:22px;vertical-align:middle;margin-right:8px;">
            Historial de Órdenes
        </div>
        <div class="history-filters search-wrapper">
         <span class="material-icons">search</span>
        <input type="text" id="searchInput" placeholder="Buscar..." />
        </div>
        
        <div class="history-table">
            <div class="scrollable-table">
        <div class="portfolio-card-body">
            <table class="portfolio-table">
                <thead>
                <tr>
                    <th><img src="https://cdn-icons-png.flaticon.com/512/1828/1828919.png" alt="Fecha" style="width:18px;height:18px;vertical-align:middle;margin-right:4px;">Fecha</th>
                    <th><img src="https://cdn-icons-png.flaticon.com/512/1828/1828911.png" alt="Tipo" style="width:18px;height:18px;vertical-align:middle;margin-right:4px;">Tipo de Orden</th>
                    <th><img src="https://cdn-icons-png.flaticon.com/512/190/190411.png" alt="Estado" style="width:18px;height:18px;vertical-align:middle;margin-right:4px;">Estado</th>
                    <th><img src="https://cdn-icons-png.flaticon.com/512/1828/1828919.png" alt="Símbolo" style="width:18px;height:18px;vertical-align:middle;margin-right:4px;">Símbolo</th>
                    <th><img src="https://cdn-icons-png.flaticon.com/512/1828/1828919.png" alt="Cantidad" style="width:18px;height:18px;vertical-align:middle;margin-right:4px;">Cantidad</th>
                    <th><img src="https://cdn-icons-png.flaticon.com/512/1256/1256650.png" alt="Precio" style="width:18px;height:18px;vertical-align:middle;margin-right:4px;">Precio</th>
                    <th><img src="https://cdn-icons-png.flaticon.com/512/1256/1256650.png" alt="Total" style="width:18px;height:18px;vertical-align:middle;margin-right:4px;">Total</th>
                    <th><img src="https://cdn-icons-png.flaticon.com/512/1828/1828919.png" alt="Timestamp" style="width:18px;height:18px;vertical-align:middle;margin-right:4px;">Timestamp</th>
                </tr>
                </thead>
                <tbody id="ordersHistoryTableBody">
                <!-- Datos dinámicos -->
                </tbody>
            </table>
        </div>
        </div>
        </div>
    </section>

    <!-- NUEVA TARJETA: Gestión de Notificaciones -->
    <section class="portfolio-card rounded-card">
        <div class="portfolio-card-header">
            <img src="https://cdn-icons-png.flaticon.com/512/1827/1827933.png" alt="Notificaciones" style="width:22px;height:22px;vertical-align:middle;margin-right:8px;">
            Gestión de Notificaciones
        </div>
        <div class="portfolio-card-body">
            <div style="display: flex; flex-wrap: wrap; gap: 2rem;">
                <!-- Canales -->
                <div style="flex:1; min-width:220px;">
                    <h4 style="margin-bottom:0.7rem; color:#8A1931; display:flex; align-items:center;"><img src='https://cdn-icons-png.flaticon.com/512/1827/1827933.png' style='width:20px;height:20px;margin-right:6px;'>Canales</h4>
                    <label style="display:flex;align-items:center;margin-bottom:0.5rem;"><img src="https://cdn-icons-png.flaticon.com/512/732/732200.png" alt="Correo" style="width:18px;height:18px;margin-right:8px;"><input type="checkbox" checked style="margin-right:8px;">Correo</label>
                    <label style="display:flex;align-items:center;margin-bottom:0.5rem;"><img src="https://cdn-icons-png.flaticon.com/512/597/597177.png" alt="SMS" style="width:18px;height:18px;margin-right:8px;"><input type="checkbox" style="margin-right:8px;">SMS</label>
                    <label style="display:flex;align-items:center;margin-bottom:0.5rem;"><img src="https://cdn-icons-png.flaticon.com/512/733/733585.png" alt="WhatsApp" style="width:18px;height:18px;margin-right:8px;"><input type="checkbox" style="margin-right:8px;">WhatsApp</label>
                </div>
                <!-- Tipos de Alerta -->
                <div style="flex:1; min-width:220px;">
                    <h4 style="margin-bottom:0.7rem; color:#8A1931; display:flex; align-items:center;"><img src='https://cdn-icons-png.flaticon.com/512/190/190411.png' style='width:20px;height:20px;margin-right:6px;'>Tipos de Alerta</h4>
                    <label style="display:flex;align-items:center;margin-bottom:0.5rem;"><img src="https://cdn-icons-png.flaticon.com/512/1828/1828911.png" alt="Movimientos" style="width:18px;height:18px;margin-right:8px;"><input type="checkbox" checked style="margin-right:8px;">Movimientos de precios</label>
                    <label style="display:flex;align-items:center;margin-bottom:0.5rem;"><img src="https://cdn-icons-png.flaticon.com/512/190/190411.png" alt="Estado" style="width:18px;height:18px;margin-right:8px;"><input type="checkbox" style="margin-right:8px;">Cambios de estado</label>
                    <label style="display:flex;align-items:center;margin-bottom:0.5rem;"><img src="https://cdn-icons-png.flaticon.com/512/190/190411.png" alt="Confirmaciones" style="width:18px;height:18px;margin-right:8px;"><input type="checkbox" checked style="margin-right:8px;">Confirmaciones</label>
                </div>
            </div>
            <div class="portfolio-card-actions" style="margin-top:2rem;">
                <button class="btn-refresh" type="button">
                    <img src="https://cdn-icons-png.flaticon.com/512/1827/1827933.png" alt="Guardar" style="width:18px;height:18px;vertical-align:middle;margin-right:4px;">Guardar
                </button>
            </div>
        </div>
    </section>

    <!-- NUEVA TARJETA: Visualización por Mercado y Sector -->
    <section class="portfolio-card rounded-card">
        <div class="portfolio-card-header">
            <img src="https://cdn-icons-png.flaticon.com/512/3135/3135789.png" alt="Mercado y Sector" style="width:22px;height:22px;vertical-align:middle;margin-right:8px;">
            Visualización por Mercado y Sector
        </div>
        <div class="portfolio-card-body">
            <div class="analysis-grid" style="gap:3rem;">
                <!-- Columna Mercado -->
                <div style="min-width:320px;">
                    <h4 style="color:#8A1931;margin-bottom:0.5rem;display:flex;align-items:center;">
                        <img src="https://cdn-icons-png.flaticon.com/512/5968/5968204.png" alt="Mercado" style="width:20px;height:20px;vertical-align:middle;margin-right:6px;">Distribución por Mercado
                    </h4>
                    <canvas id="marketChart" width="320" height="180"></canvas>
                    <div style="margin-top:1rem;display:flex;gap:0.5rem;flex-wrap:wrap;">
                        <button class="btn-refresh"><img src="https://cdn-icons-png.flaticon.com/512/5968/5968204.png" alt="NYSE" style="width:20px;height:20px;vertical-align:middle;margin-right:6px;">NYSE</button>
                        <button class="btn-refresh"><img src="https://cdn-icons-png.flaticon.com/512/5968/5968204.png" alt="NASDAQ" style="width:20px;height:20px;vertical-align:middle;margin-right:6px;">NASDAQ</button>
                        <button class="btn-refresh"><img src="https://cdn-icons-png.flaticon.com/512/5968/5968204.png" alt="LSE" style="width:20px;height:20px;vertical-align:middle;margin-right:6px;">LSE</button>
                        <button class="btn-refresh"><img src="https://cdn-icons-png.flaticon.com/512/5968/5968204.png" alt="TSE" style="width:20px;height:20px;vertical-align:middle;margin-right:6px;">TSE</button>
                        <button class="btn-refresh"><img src="https://cdn-icons-png.flaticon.com/512/5968/5968204.png" alt="ASX" style="width:20px;height:20px;vertical-align:middle;margin-right:6px;">ASX</button>
                    </div>
                </div>
                <!-- Columna Sector -->
                <div style="min-width:320px;">
                    <h4 style="color:#8A1931;margin-bottom:0.5rem;display:flex;align-items:center;">
                        <img src="https://cdn-icons-png.flaticon.com/512/3135/3135789.png" alt="Sector" style="width:20px;height:20px;vertical-align:middle;margin-right:6px;">Distribución por Sector
                    </h4>
                    <canvas id="sectorChart" width="320" height="180"></canvas>
                </div>
            </div>
        </div>
    </section>

    <!-- NUEVA TARJETA: Logs del Sistema -->
    <section class="portfolio-card rounded-card">
        <div class="portfolio-card-header">
            <img src="https://cdn-icons-png.flaticon.com/512/1828/1828911.png" alt="Logs" style="width:22px;height:22px;vertical-align:middle;margin-right:8px;">
            Logs del Sistema
        </div>
        <div class="portfolio-card-body" style="max-height:200px;overflow:auto;background:#f8f9fa;">
            <pre id="logsBox" style="font-size:0.95em;color:#2c3e50;white-space:pre-wrap;">Cargando logs...</pre>
        </div>
    </section>

    <!-- Gráficos y Análisis -->
    <section class="portfolio-analysis">
        <div class="analysis-grid">
            <div class="analysis-card chart-card">
                <div class="card-header">
                    <h3>Rendimiento del Portafolio</h3>
                    <div class="chart-controls">
                        <button class="btn-time active" data-period="1D">1D</button>
                        <button class="btn-time" data-period="1W">1S</button>
                        <button class="btn-time" data-period="1M">1M</button>
                        <button class="btn-time" data-period="1Y">1A</button>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="portfolioChart"></canvas>
                </div>
            </div>

            <div class="analysis-card distribution-card">
                <div class="card-header">
                    <h3>Distribución del Portafolio</h3>
                </div>
                <div class="chart-container">
                    <canvas id="distributionChart"></canvas>
                </div>
            </div>

            <div class="analysis-card performance-card">
                <div class="card-header">
                    <h3>Rendimiento por Sector</h3>
                </div>
                <div class="sector-performance">
                    <div class="sector-item">
                        <div class="sector-info">
                            <span class="sector-name">Tecnología</span>
                            <span class="sector-value">45.2%</span>
                        </div>
                        <div class="sector-bar">
                            <div class="bar-fill" style="width: 45.2%"></div>
                        </div>
                    </div>
                    <div class="sector-item">
                        <div class="sector-info">
                            <span class="sector-name">Financiero</span>
                            <span class="sector-value">25.8%</span>
                        </div>
                        <div class="sector-bar">
                            <div class="bar-fill" style="width: 25.8%"></div>
                        </div>
                    </div>
                    <div class="sector-item">
                        <div class="sector-info">
                            <span class="sector-name">Salud</span>
                            <span class="sector-value">15.3%</span>
                        </div>
                        <div class="sector-bar">
                            <div class="bar-fill" style="width: 15.3%"></div>
                        </div>
                    </div>
                    <div class="sector-item">
                        <div class="sector-info">
                            <span class="sector-name">Otros</span>
                            <span class="sector-value">13.7%</span>
                        </div>
                        <div class="sector-bar">
                            <div class="bar-fill" style="width: 13.7%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Posiciones Actuales -->
    <section class="portfolio-positions">
        <div class="positions-header">
            <h2>Posiciones Actuales</h2>
            <div class="positions-actions">
                <div class="search-box">
                    <span class="material-icons">search</span>
                    <input type="text" placeholder="Buscar posiciones..." id="positionSearch">
                </div>
                <button class="btn-sort">
                    <span class="material-icons">sort</span>
                    Ordenar
                </button>
            </div>
        </div>

        <div class="positions-table">
            <table>
                <thead>
                <tr>
                    <th>Símbolo</th>
                    <th>Nombre</th>
                    <th>Cantidad</th>
                    <th>Precio Promedio</th>
                    <th>Precio Actual</th>
                    <th>Valor Total</th>
                    <th>Ganancia/Pérdida</th>
                    <th>Acciones</th>
                </tr>
                </thead>
                <tbody id="positionsTableBody">
                <!-- Las posiciones se cargarán dinámicamente -->
                </tbody>
            </table>
        </div>
    </section>

    <!-- Historial de Transacciones -->
    <section class="portfolio-history">
        <div class="history-header">
            <h2>Historial de Transacciones</h2>
            <div class="history-filters">
                <select id="transactionType">
                    <option value="all">Todas las transacciones</option>
                    <option value="buy">Compras</option>
                    <option value="sell">Ventas</option>
                </select>
                <input type="date" id="transactionDate">
            </div>
        </div>

       
        </div>
    </section>
</main>

<!-- Footer -->
<div id="footer-placeholder"></div>

<!-- 1) session.js -->
<script src="../../js/session.js"></script>

<!-- 1.1) portfolio.js -->
<script src="../../js/portfolio.js"></script>


<!-- 2) Exponemos `usuario` e `isPremium` ANTES de cargar el summary -->
<script>
    // Protejo ruta y obtengo user
    const usuario = JSON.parse(localStorage.getItem('usuario') || '{}');
    if (!usuario.id) {
        // Sin sesión, redirige
        window.location.href = 'login.html';
    }
    // Exponemos para el summary
    window.usuario = usuario;
    window.isPremium = !!usuario.esPremium;
</script>


<!-- 3) Inyectamos el partial PREMIUM y luego su JS -->
<script>
    fetch('/frontend/html/pages/watchlist-summary-premium.html')
        .then(res => {
            if (!res.ok) throw new Error('HTTP ' + res.status);
            return res.text();
        })
        .then(html => {
            // Inyecto el partial en el DIV correcto
            document.getElementById('watchlist-content').innerHTML = html;
            // Y ahora cargo el script que arranca la lógica interna del summary
            const script = document.createElement('script');
            script.src = '/frontend/js/watchlist-summary.js';
            document.body.appendChild(script);
        })
        .catch(err => {
            console.error('Error cargando el Watchlist Summary:', err);
            document.getElementById('watchlist-content').innerHTML =
                '<p class="error">No se pudo cargar tu Watchlist.</p>';
        });
</script>

<!-- 4) Incluimos el include-components -->
<script src="/frontend/js/include-components.js"></script>
</body>
</html>